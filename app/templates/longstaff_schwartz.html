{% extends "index.html" %}

{% block content %}
<div style="display: flex; gap: 2em; align-items: flex-start;">

  <!-- ========== SIDEBAR ========== -->
  <aside style="width: 200px;">
    <nav>
      <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.5em;">
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='theory') }}"
             class="sidebar-link {% if section=='theory' %}active{% endif %}">Teoria</a>
        </li>
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='plot4') }}"
             class="sidebar-link {% if section=='plot4' %}active{% endif %}">Momenty wykonania</a>
        </li>
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='plot1') }}"
             class="sidebar-link {% if section=='plot1' %}active{% endif %}">Dopasowanie baz wielomianu regresji</a>
        </li>
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='plot2') }}"
             class="sidebar-link {% if section=='plot2' %}active{% endif %}">Opcja amerykanska put z dywidendą</a>
        </li>
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='plot3') }}"
             class="sidebar-link {% if section=='plot3' %}active{% endif %}">Baza wielomianowa vs cena opcji</a>
        </li>
        <li>
          <a href="{{ url_for('routes.longstaff_schwartz', section='plot5') }}"
             class="sidebar-link {% if section=='plot5' %}active{% endif %}">Dokładność estymatora</a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- ========== CONTENT ========== -->
  <section style="flex: 1; background: white; padding: 1.5em;
                  border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.05);">
    {% if section == "theory" %}
      <!DOCTYPE html>
      <html lang="pl">
      <head>
        <meta charset="UTF-8">
        <title>Metoda Longstaff-Schwartz</title>

        <!-- Konfiguracja MathJax: definiujemy delimitery TeX -->
        <script>
          window.MathJax = {
            tex: {
              inlineMath: [['$', '$'], ['\\(', '\\)']],
              displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
              fontCache: 'global'
            }
          };
        </script>

        <!-- Polyfill i sam silnik MathJax -->
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async
                src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
      </head>
      <body>

      <section>
       
      <h2>Idea metody</h2>
      <div class="math display">
      $$
      V(0) = \sup_{\tau \in \mathcal{T}} \mathbb{E}^Q\!\Bigl[\frac{Y(\tau)}{B(\tau)}\Bigr],
      $$
      </div>
      <p>gdzie <span class="math">$B(t) = \exp\bigl(\int_0^t r_u\,du\bigr)$</span> to rachunek bez-ryzyka, a <span class="math">$\mathcal{T}$</span> oznacza zbiór dopuszczalnych czasów realizacji.</p>
      <p>Aby przybliżyć wartość opcji w czasie, definiujemy tzw. <strong>proces wartości maksymalnej</strong>, który obliczamy rekurencyjnie od końca:</p>
      <div class="math display">
      $$
      V(t_m) = Y(t_m), \quad
      V(t_i) = \max\Bigl\{\,Y(t_i),\,\mathbb{E}^Q\bigl[V(t_{i+1})/B(t_{i+1})\mid\mathcal{F}_{t_i}\bigr]\;B(t_i)\Bigr\}.
      $$
      </div>
      <p>Wartość kontynuacji, czyli oczekiwany zysk z dalszego utrzymania opcji zamiast jej natychmiastowego wykonania, obliczamy jako:</p>
      <div class="math display">
      $$
      C(t_i)
      = \mathbb{E}^Q\bigl[V(t_{i+1})/B(t_{i+1})\mid\mathcal{F}_{t_i}\bigr]\; B(t_i).
      $$
      </div>
      <p>Opcję wykonujemy w chwili <span class="math">$t_i$</span>, jeśli <span class="math">$Y(t_i) \ge C(t_i)$</span>.</p>

      <hr>

      <h2>Metoda LSM: oszacowanie warunkowej wartości kontynuacji</h2>
      <ol>
        <li>
          <strong>Symulacja ścieżek</strong><br>
          Generujemy <span class="math">$n$</span> ścieżek cen <span class="math">$S(t_i,\omega_k)$</span> pod miarą ryzyka-neutralną <span class="math">$Q$</span>.
        </li>
        <li>
          <strong>Oszacowanie regresją</strong>
          <ul>
            <li>Dla każdego <span class="math">$t_i$</span> zbieramy pary <span class="math">$(S(t_i,\omega_k),\,V(t_{i+1},\omega_k))$</span> tylko dla ścieżek „in-the-money”.</li>
            <li>Przybliżamy <span class="math">$C(t_i)$</span> jako kombinację <span class="math">$M$</span> <em>funkcji bazowych</em> <span class="math">$L_j$</span>:
              <div class="math display">
              $$
              C(t_i)\approx \sum_{j=0}^M \alpha_{ij}\,L_j\bigl(S(t_i)\bigr).
              $$
              </div>
            </li>
            <li>Współczynniki <span class="math">$\alpha_{ij}$</span> wyznaczamy metodą najmniejszych kwadratów, badając różnicę <span class="math">$V(t_{i+1})/B(t_{i+1})\,B(t_i)$</span> względem <span class="math">$L_j(S(t_i))$</span>.</li>
          </ul>
        </li>
        <li>
          <strong>Reguła zatrzymania</strong><br>
          Dla każdej ścieżki w krokach wstecznych:
          <div class="math display">
          $$
          V(t_i,\omega_k) =
          \begin{cases}
            Y(t_i,\omega_k), & Y(t_i)\ge \hat C(t_i),\\
            V(t_{i+1},\omega_k), & Y(t_i)< \hat C(t_i).
          \end{cases}
          $$
          </div>
        </li>
        <li>
          <strong>Ostateczna cena</strong><br>
          Z symulowanych wartości <span class="math">$V(0,\omega_k)$</span> obliczamy średnią:
          <div class="math display">
          $$
          V(0)\approx \frac{1}{n}\sum_k V(0,\omega_k).
          $$
          </div>
        </li>
      </ol>

      <hr>

      <h2>Wybór funkcji bazowych</h2>
      <p>Najczęściej używa się wielomianów Laguerre’a, Eksponencjalnych Laguerre’a lub zwykłych potęg:</p>
      <div class="math display">
      $$
      L_0(x) = 1,\quad
      L_1(x) = e^{-x/2}(1 - x),\quad
      L_2(x) = e^{-x/2}\bigl(2 - 4x + x^2\bigr),\dots
      $$
      </div>
      <p>W praktyce wystarcza kilka pierwszych baz (3–5).</p>

      <hr>

      <h2>Własności estymatora</h2>
      <ul>
        <li>Przy <span class="math">$n \to \infty$</span> i ustalonym <span class="math">$M$</span> estymator zbiega do wartości optymalnej <strong>od dołu</strong>, co oznacza brak przeceny.</li>
        <li>Regresja LS zapewnia spójność i zbieżność w kwadracie (White, 1984).</li>
      </ul>

      <hr>

      <blockquote>
        <p><strong>Podsumowanie</strong>: Metoda Longstaff–Schwartz łączy podejście dynamiczne z symulacją Monte Carlo i metodą najmniejszych kwadratów, umożliwiając efektywne oszacowanie optymalnego momentu wykonania oraz wartości opcji amerykańskiej.</p>
      </blockquote>

      </body>
      </html>


    {% elif section == "plot1" %}
      <img 
        src="{{ url_for('static', filename='images/dopasowanie.jpeg') }}" 
        alt="Wykres 1" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
        <img 
        src="{{ url_for('static', filename='images/dop_regresji.jpeg') }}" 
        alt="Wykres 3" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
        <img 
        src="{{ url_for('static', filename='images/tornado.jpeg') }}" 
        alt="Wykres 2" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
    {% elif section == "plot2" %}
      <img 
        src="{{ url_for('static', filename='images/heatmapa2.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
      <img 
        src="{{ url_for('static', filename='images/scatter.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
        <img 
        src="{{ url_for('static', filename='images/dywidenda.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
    {% elif section == "plot3" %}
      <img 
        src="{{ url_for('static', filename='images/estym_LSM.jpeg') }}" 
        alt="Wykres 1" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
        <img 
        src="{{ url_for('static', filename='images/wiel_rzedu5.jpeg') }}" 
        alt="Wykres 3" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
    {% elif section == "plot4" %}
      <img 
        src="{{ url_for('static', filename='images/mom_wyk.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
    {% elif section == "plot5" %}
      <img 
        src="{{ url_for('static', filename='images/biasLSM.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
      <img 
        src="{{ url_for('static', filename='images/bladLSM.jpeg') }}" 
        alt="Wykres 4" 
        style="max-width:100%; border:1px solid #ddd; border-radius:8px; margin-top:1em;">
    {% else %}
      <p>Wystąpił błąd. Przejdź do innej karty.</p>
    {% endif %}
  </section>

</div>
{% endblock %}

